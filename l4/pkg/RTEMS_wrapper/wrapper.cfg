-- vim:set ft=lua;

-- This is the configuration file for the RTEMS Wrapper

require("L4")

local ld = L4.default_loader;

local fbserv = ld:new_channel();
local fbdrv = ld:new_channel();


ld:start( { caps = { fbdrv = fbdrv:svr(),
		     icu = L4.Env.icu,
		     sigma0 = L4.cast( L4.Proto.Factory, L4.Env.sigma0):create(
		     L4.Proto.Sigma0 ),
		     },
	    log = { "IO", "Y" } },
	    "rom/io rom/x86-legacy.devs rom/x86-fb.io" );

ld:start( { caps = { vbus = fbdrv,
		     fb = fbserv:svr(),
		     },
	    log = { "FB" , "B" } },
	    "rom/fb-drv -m 0x117" );

local wrapper_caps = {
  mem = L4.Env.mem_alloc,
  goosfb = fbserv,  
  };

ld:start( {caps = wrapper_caps, log= {"wrapper", "green"} },
		  "rom/RTEMS_wrapper rom/myHello.exe");
